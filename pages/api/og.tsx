import { ImageResponse } from "@vercel/og";
import { NextRequest } from "next/server";

export const config = {
  runtime: "edge",
};

export default async function handler(req: NextRequest) {
  try {
    const { searchParams } = new URL(req.url);

    // ?title=<title>
    const hasTitle = searchParams.has("title");
    const title = hasTitle
      ? searchParams.get("title")?.slice(0, 100)
      : "タイトル";

    const baseUrl = req.url.split("/api")[0];

    return new ImageResponse(
      (
        <div
          style={{
            backgroundImage: `url(${baseUrl}/_next/image?url=%2Fog-bg.png&w=1200&q=75)`,
            backgroundColor: "#fff",
            backgroundSize: "100% 100%",
            height: "100%",
            width: "100%",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            flexDirection: "column",
            flexWrap: "nowrap",
          }}
        >
          <svg viewBox="0 0 313.77 112.954" fill="black">
            <path d="M175.684 71.289l-6.348-29.199a.423.423 0 00-.04-.16q-.137-.321-.741-.963-.738-.784-1.128-1.002a1.093 1.093 0 00-.044-.024 1.459 1.459 0 01-.206-.013q-.11-.016-.202-.05a.776.776 0 01-.08-.034 1.257 1.257 0 01-.103-.004q-.101-.008-.167-.035a.303.303 0 01-.023-.01.47.47 0 00-.11-.04.399.399 0 00-.086-.009 5.151 5.151 0 00-2.734.803 7.342 7.342 0 00-1.123.857 17.106 17.106 0 00-1.851 2.012 22.995 22.995 0 00-1.518 2.187 42.577 42.577 0 00-1.877 3.403 52.131 52.131 0 00-1.053 2.262 87.206 87.206 0 00-2.441 6.201q-1.075 3.076-1.905 5.664a260.205 260.205 0 01-.393 1.217q-.384 1.177-.677 2.03a63.493 63.493 0 01-.248.708 1.638 1.638 0 01-.235.092q-.397.125-1.16.228a17.85 17.85 0 01-.168.022q-1.171.146-1.562.146a6.256 6.256 0 01-1.784-.24 4.644 4.644 0 01-2.415-1.664q-1.465-1.904-2.393-4.736a45.467 45.467 0 01-1.042-3.738 56.11 56.11 0 01-.52-2.464 53.443 53.443 0 00-.883-3.906 43.289 43.289 0 00-.68-2.295 16.142 16.142 0 00-1.079-2.563 12.284 12.284 0 00-1.46-2.173 5.251 5.251 0 00-3.24-1.8 7.746 7.746 0 00-1.301-.104 1.263 1.263 0 00-.758.276q-.471.349-.921 1.139a8.986 8.986 0 00-.372.733 21.581 21.581 0 00-.705 1.769q-.564 1.606-1.053 3.651a122.86 122.86 0 00-.938 4.28 148.62 148.62 0 00-.526 2.751 172.064 172.064 0 00-.623 3.638 138.155 138.155 0 00-.5 3.393 171.712 171.712 0 00-.296 2.31q-.108.902-.193 1.704a81.097 81.097 0 00-.146 1.504l-.195 2.246a1.165 1.165 0 01-.156.183q-.17.167-.454.347a5.244 5.244 0 01-.172.105 58.375 58.375 0 00-.906.54 67.123 67.123 0 00-.314.192q-.635.391-1.27.586a8.167 8.167 0 01-.296.086q-.412.11-.632.11a6.362 6.362 0 01-3.096-.833q-.899-.493-1.774-1.279a12.527 12.527 0 01-.403-.379 21.928 21.928 0 01-2.429-2.856q-1.015-1.41-1.946-3.1a36.466 36.466 0 01-.264-.489 61.385 61.385 0 01-2.472-5.268 74.262 74.262 0 01-1.336-3.472 106.967 106.967 0 01-2.561-8.153 96.366 96.366 0 01-.32-1.222 127.49 127.49 0 01-.981-4.11q-.428-1.942-.739-3.694a76.262 76.262 0 01-.087-.497q-.635-3.711-.635-5.664 0-1.602.358-2.742a4.838 4.838 0 01.472-1.067q.793-1.305 3.321-1.364a10.429 10.429 0 01.244-.003q.24 0 .842.033a67.073 67.073 0 01.281.016 96.246 96.246 0 00.289.017q.532.029.709.032a2.101 2.101 0 00.027 0q.684 3.027 1.416 6.592.733 3.564 1.709 7.177.977 3.614 2.198 7.129a33.605 33.605 0 001.833 4.32 28.558 28.558 0 001.145 2.028 10.993 10.993 0 002.539-4.395q.781-2.539 1.172-5.127a656.059 656.059 0 00.558-3.772 581.708 581.708 0 00.174-1.208 12.12 12.12 0 01.482-2.093 9.16 9.16 0 01.934-2.009 5.94 5.94 0 012.483-2.194 7.625 7.625 0 01.691-.296q1.931-.718 5.226-.115a22.615 22.615 0 01.585.115 18.074 18.074 0 012.596.175q1.35.196 2.458.613a8.484 8.484 0 011.489.726 16.313 16.313 0 014.248 3.808 71.885 71.885 0 013.301 4.561 78.717 78.717 0 01.214.322 19.178 19.178 0 003.701 4.118 21.971 21.971 0 00.645.521L150 45.166a32.044 32.044 0 011.128-2.204 41.175 41.175 0 011.069-1.8q1.319-2.099 2.832-4.199a34.857 34.857 0 012.455-3.042 30.855 30.855 0 01.719-.767q1.66-1.709 3.418-2.832a8.054 8.054 0 011.385-.716q.921-.362 1.814-.402a4.941 4.941 0 01.219-.005q4.004 0 6.934 2.49a21.45 21.45 0 013.855 4.343 25.922 25.922 0 011.174 1.907 38.69 38.69 0 012.541 5.586 46.287 46.287 0 01.926 2.813 90.45 90.45 0 011.603 6.217 77.622 77.622 0 01.545 2.718 109.999 109.999 0 01.672 4.114 81.688 81.688 0 01.451 3.748 137.796 137.796 0 01.15 1.657q.172 2.055.19 3.21a16.56 16.56 0 01.002.26 4.413 4.413 0 01-.06.753q-.128.735-.526 1.2-.586.683-1.465 1.025a6.895 6.895 0 01-1.509.392 7.982 7.982 0 01-.395.048 22.377 22.377 0 01-1.107.079 17.626 17.626 0 01-.797.018q-.196 0-.586-.048a10.195 10.195 0 01-.388-.057q-.232-.038-.491-.09a17.975 17.975 0 01-.214-.055q-.239-.063-.556-.152a64.392 64.392 0 01-.304-.086zm33.834-50.088a34.299 34.299 0 00-.045 1.748q0 6.641 1.367 12.647a62.7 62.7 0 00.452 1.856 55.372 55.372 0 003.308 9.325q2.392 5.176 5.566 9.278a48.768 48.768 0 002.428 2.904 39.857 39.857 0 004.261 4.078 29.536 29.536 0 002.658 1.948 23.322 23.322 0 004.52 2.3q3.016 1.126 5.933 1.126a14.99 14.99 0 001.245-.052 79.166 79.166 0 01-.086 3.589 104.587 104.587 0 01-.256 3.931 319.203 319.203 0 00-.586 8.398 253.217 253.217 0 00-.342 8.545 66.585 66.585 0 00-.017 1.53q0 .853.022 1.687a55.195 55.195 0 00.337 4.84 35.573 35.573 0 00.426 2.76 28.562 28.562 0 001.137 4.174 15.414 15.414 0 00.904 2.052 11.841 11.841 0 002.27 3.026 1.19 1.19 0 00.378.063q1.258 0 2.405-2.847a21.388 21.388 0 00.119-.303q.837-2.17 1.532-5.326a73.213 73.213 0 00.644-3.306 138.886 138.886 0 00.27-1.63q.401-2.499.766-5.329a251.506 251.506 0 00.721-6.225 259.177 259.177 0 00.367-3.799 290.962 290.962 0 00.805-11.875q.391-8.154.391-16.406 0-8.252-.391-15.332a180.579 180.579 0 00-.118-1.958q-.191-2.889-.46-5.482a105.298 105.298 0 00-.642-5.06 60.584 60.584 0 00-.292-1.744q-.498-2.716-1.129-4.559a13.477 13.477 0 00-.679-1.656 6.824 6.824 0 00-2.779 1.797 7.52 7.52 0 00-1.469 2.402 17.595 17.595 0 00-.02.052q-.634 1.639-1.001 3.558a28.404 28.404 0 00-.444 3.666 72.566 72.566 0 00-.122 4.26 84.37 84.37 0 00.122 4.48 150.721 150.721 0 01.153 3.689q.051 1.777.051 3.418a100.745 100.745 0 01-.009 1.291q-.03 2.388-.31 4.239a16.822 16.822 0 01-.422 2.011 4.584 4.584 0 01-.405 1.008q-.467.835-1.246 1.183a3.097 3.097 0 01-1.279.251 20.748 20.748 0 01-1.195.035q-1.61 0-3.039-.266a12.073 12.073 0 01-4.262-1.625 17.876 17.876 0 01-1.493-1.048 19.117 19.117 0 01-4.268-4.713q-2.344-3.614-3.809-8.155-1.465-4.541-2.734-8.984a180.242 180.242 0 00-.682-2.326 155.478 155.478 0 00-1.955-6.072 35.688 35.688 0 00-.397-1.093q-.605-1.58-1.296-2.909a19.325 19.325 0 00-1.53-2.493 1.013 1.013 0 01-.148-.011q-.149-.023-.34-.086h-.586q-.803 0-1.353.176a2.077 2.077 0 00-.551.263 2.518 2.518 0 00-.596.582 3.217 3.217 0 00-.381.688q-.342.83-.391 1.758a37.336 37.336 0 00-.003.058zM0 5.371v-.879q3.809-1.953 7.178-2.881A40.896 40.896 0 0113.916.342Q17.285 0 20.752 0h7.568q.72 0 2.392.041a337.383 337.383 0 01.294.008 144.188 144.188 0 001.977.036 178.591 178.591 0 002.124.013h6.69a3.128 3.128 0 011.66 1.367 8.126 8.126 0 01.879 2.051q.293 1.074.391 2.197.074.86.092 1.405a9.532 9.532 0 01.005.304H12.598v20.996h34.961a8.674 8.674 0 01-.265 2.204 6.163 6.163 0 01-1.786 3.021 13.272 13.272 0 01-3.091 2.12 16.994 16.994 0 01-2.036.858q-3.076 1.074-6.885 1.416a74.334 74.334 0 01-4.636.276q-.877.023-1.73.023a60.248 60.248 0 01-.86-.006 127.109 127.109 0 01-2.842-.071q-1.73-.063-3.213-.173a171.209 171.209 0 00-1.07-.076q-1.759-.119-2.446-.119v2.05q0 4.102 1.953 7.764a68.767 68.767 0 004.346 7.08 120.207 120.207 0 013.759 5.698 107.666 107.666 0 01.636 1.04 14.422 14.422 0 011.517 3.398 11.85 11.85 0 01.485 3.341q0 2.148-.879 3.759a2.932 2.932 0 01-1.957 1.469q-.568.143-1.266.143-2.012 0-3.991-1.725a11.946 11.946 0 01-.843-.814 23.446 23.446 0 01-1.993-2.447q-1.347-1.884-2.646-4.34a66.668 66.668 0 01-2.185-4.566 90.024 90.024 0 01-2.063-5.2 214.757 214.757 0 01-3.354-10.03 237.144 237.144 0 01-.454-1.493 216.67 216.67 0 01-3.223-11.914q-1.416-5.909-2.393-11.036a297.374 297.374 0 01-.779-4.252q-.34-1.938-.611-3.658a162.539 162.539 0 01-.172-1.123A96.138 96.138 0 01.33 9.216Q0 6.689 0 5.371zm60.645 15.82v2.051q-.098.488-.391 2.295a185.012 185.012 0 01-.317 1.892 241.02 241.02 0 01-.367 2.063 644.756 644.756 0 01-.378 2.063 498.367 498.367 0 01-.354 1.892 59.975 59.975 0 00-.116.631q-.17.956-.212 1.416a2.838 2.838 0 00-.014.248q0 1.856.391 4.639a57.966 57.966 0 00.738 4.127 67.627 67.627 0 00.385 1.683q.732 3.028 1.855 6.055a29.097 29.097 0 001.576 3.536 24.262 24.262 0 001.11 1.884 19.126 19.126 0 001.852 2.414 15.301 15.301 0 001.615 1.541q1.904 1.563 4.443 1.563 3.125 0 5.518-1.661 2.392-1.66 4.15-4.296a24.33 24.33 0 002.28-4.34 28.595 28.595 0 00.601-1.617q1.123-3.321 1.806-6.69a63.769 63.769 0 00.806-4.916 55.65 55.65 0 00.171-1.578 77.659 77.659 0 00.178-2.234q.072-1.106.099-2.093a42.068 42.068 0 00.016-1.142 28.808 28.808 0 00-.177-3.243 24.956 24.956 0 00-.165-1.2 58.481 58.481 0 00-.83-4.151 64.008 64.008 0 01-.83-4.052 24.038 24.038 0 01-.342-4.053 4.078 4.078 0 01.116-1.007 2.547 2.547 0 011.203-1.63q1.318-.781 2.978-.781a5.613 5.613 0 011.483.186 4.204 4.204 0 011.837 1.035 8.097 8.097 0 011.548 2.082 10.032 10.032 0 01.454.994 14.096 14.096 0 01.663 2.224 18.738 18.738 0 01.314 2.024q.244 2.393.244 4.736 0 2.344-.098 4.444-.087 1.878-.096 3.092a36.529 36.529 0 00-.001.277 54.143 54.143 0 01-.108 3.306q-.121 1.982-.381 4.213a56.254 56.254 0 01-1.21 6.711 64.213 64.213 0 01-.499 1.932q-1.22 4.443-3.027 8.74a35.78 35.78 0 01-3.001 5.698 31.343 31.343 0 01-1.393 1.968 22.405 22.405 0 01-4.322 4.312 20.423 20.423 0 01-1.635 1.108 14.154 14.154 0 01-7.047 2.043 16.887 16.887 0 01-.522.008 15.558 15.558 0 01-4.306-.575 13.1 13.1 0 01-3.409-1.525 18.61 18.61 0 01-5.47-5.351 21.336 21.336 0 01-.145-.215 34.16 34.16 0 01-2.809-5.206 40.858 40.858 0 01-1.048-2.656 58.785 58.785 0 01-2.393-8.789 83.827 83.827 0 01-1.066-7.372 75.416 75.416 0 01-.106-1.173 119.002 119.002 0 01-.208-2.954q-.134-2.331-.134-4.223 0-.586.049-2.1a95.255 95.255 0 00.046-2.353 109.201 109.201 0 00.003-.821 100.867 100.867 0 01.012-1.599 79.546 79.546 0 01.037-1.477 157.988 157.988 0 00.021-.656q.028-.906.028-1.346a17.042 17.042 0 011.381-2.011 19.058 19.058 0 01.23-.284 6.91 6.91 0 01.74-.773q.441-.391.903-.639a3.885 3.885 0 01.31-.15q.923-.396 2.004-.198a4.533 4.533 0 01.242.051 2.97 2.97 0 01.923.412q.774.504 1.568 1.541zM301.27 60.84q-3.711 2.539-6.397 4.541-2.685 2.002-5.225 3.369a22.178 22.178 0 01-5.419 2.051 22.33 22.33 0 01-2.347.416q-1.31.166-2.819.229a46.064 46.064 0 01-1.915.038 27.183 27.183 0 01-4.979-.426q-2.83-.528-5.026-1.711a12.949 12.949 0 01-3.471-2.697q-3.418-3.76-4.178-10.385a35.336 35.336 0 01-.217-4.019q0-3.711.977-7.715a40.087 40.087 0 012.589-7.34 44.541 44.541 0 01.292-.619q1.904-3.955 4.541-7.519 2.637-3.565 5.957-6.299a29.213 29.213 0 017.08-4.346 19.992 19.992 0 017.959-1.611 34.107 34.107 0 014.453.712q3.947.923 6.582 2.755a17.807 17.807 0 016.055 7.129q2.051 4.345 2.832 9.668a161.671 161.671 0 011.207 10.809 176.014 176.014 0 01.013.177 266.726 266.726 0 001.123 11.328 37.073 37.073 0 001.795 7.845 33.044 33.044 0 001.038 2.604q-1.27 3.223-2.393 4.541a2.958 2.958 0 01-.408.4q-.959.762-2.082.04a4.259 4.259 0 01-.758-.646q-.732-.767-1.571-2.151a29.506 29.506 0 01-.845-1.5 70.499 70.499 0 01-1.21-2.413q-1.421-2.958-3.233-7.255zM192.236 34.912a150.043 150.043 0 00-.007.204q-.041 1.161-.041 1.7 0 1.392.027 3.663a738.417 738.417 0 00.021 1.611 145.857 145.857 0 00.098 3.589 192.139 192.139 0 00.195 3.93 83.944 83.944 0 00.928 8.35 59.579 59.579 0 00.682 3.568 46.42 46.42 0 001.125 4.147 24.474 24.474 0 00.067.205q.512 1.533 1.169 2.822a14.658 14.658 0 001.742 2.686 7.621 7.621 0 00.356.401 5.635 5.635 0 004.234 1.845q4.492 0 4.492-4.395a47.033 47.033 0 00-.25-4.762 60.232 60.232 0 00-.97-6.175 248.136 248.136 0 00-2.784-11.865 425.903 425.903 0 01-2.929-11.963q-1.368-5.957-1.661-11.231a17.875 17.875 0 00-.274.094 19.395 19.395 0 00-3.192 1.469 8.352 8.352 0 00-2.784 2.539q0 .439-.027 1.318a143.08 143.08 0 01-.021.635 1088.534 1088.534 0 00-.013.343 1208.198 1208.198 0 00-.085 2.489 815.917 815.917 0 01-.049 1.428 696.842 696.842 0 01-.049 1.355zm77.216 25.389a6.5 6.5 0 00.226.295 6.073 6.073 0 002.449 1.763q1.975.818 4.976.825a22.267 22.267 0 00.045 0 21.072 21.072 0 007.666-1.416q3.663-1.416 6.397-3.907a18.987 18.987 0 004.394-6.006q1.661-3.515 1.661-7.812a84.215 84.215 0 01.006-.967q.012-1.089.051-2.555a317.211 317.211 0 01.04-1.41 34.353 34.353 0 00.017-1.056 33.906 33.906 0 00-.407-5.242 17.192 17.192 0 00-.708-2.918 13.271 13.271 0 00-1.148-2.502q-1.367-2.295-4.101-2.295a17.838 17.838 0 00-9.375 2.588 27.05 27.05 0 00-7.422 6.591 32.097 32.097 0 00-4.883 8.838 29.909 29.909 0 00-1.421 5.33 24.421 24.421 0 00-.337 3.996q0 5.26 1.874 7.86zM196.437 2.413a7.232 7.232 0 00-2.882-2.218 6.049 6.049 0 00-1.297.13 3.473 3.473 0 00-2.463 1.823 8.627 8.627 0 00-.804 2.287 11.431 11.431 0 00-.221 2.303 38.092 38.092 0 001.22.402q3.837 1.187 5.615.721 2.051-.537 2.198-1.953.105-1.019-.523-2.215a7.994 7.994 0 00-.6-.959 8.732 8.732 0 00-.243-.321z" />
          </svg>
          <div
            style={{
              width: "100%",
              fontSize: 60,
              fontStyle: "normal",
              fontWeight: "bold",
              color: "#000",
              padding: "0 120px",
              lineHeight: 1.3,
              marginBottom: "30px",
              wordWrap: "break-word",
              justifyContent: "center",
            }}
          >
            {title}
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
      }
    );
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500,
    });
  }
}
